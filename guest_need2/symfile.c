#include <sys/mman.h>
#include<stdio.h>
#include<unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include<malloc.h>
#include "s2e.h"
#define FILE_LENGTH 120133

int main()
{
    int fd;
	pid_t pid;
    int i;
    char *p;
	fd = open("./gg.mov",O_RDWR);
    if (fd<0)
    {
        printf("open file  error \n");
        return 0;
    }
	struct stat b;
	fstat(fd , &b);
	p=mmap(0,b.st_size, PROT_READ|PROT_WRITE,MAP_SHARED,fd,0);
    //p[0] = 'a';
	printf("%c" , p[0]);
	s2e_make_concolic(p,b.st_size, "buf");

	if((pid = fork())==0){

	    char * argv[ ] ={ ¡§./mplayer¡¨,"./gg.mov¡¨,0};
		execvp("../mplayer",argv);
	}else{
	    wait();
	}
    close(fd);
	s2e_kill_state(0, "program terminated");
    return 0;
}